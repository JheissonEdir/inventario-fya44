<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="inventario_favicon.svg">
    <title>Inventario del Colegio Fe y Alegría 44 - 2025</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 10px; background: #fff; }
        h2 { color: #b71c1c; text-align: center; margin-bottom: 0; text-shadow: 2px 2px 6px #e57373, 0 1px 0 #fff; }
        h3 { color: #b71c1c; text-align: center; margin-top: 8px; text-shadow: 2px 2px 6px #e57373, 0 1px 0 #fff; }
        .subtitulo { text-align: center; color: #b71c1c; font-size: 1.1em; margin-bottom: 18px; text-shadow: 1px 1px 4px #ffcdd2; }
        form { background: #fff; padding: 16px; border-radius: 8px; box-shadow: 0 2px 8px #0001; max-width: 600px; margin: 0 auto; }
        form label { display: block; margin-bottom: 8px; font-size: 1em; text-shadow: 1px 1px 2px #f8bbd0; }
        form input, form select { width: 100%; padding: 7px; margin-top: 2px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; text-shadow: 1px 1px 2px #ffcdd2; }
        .btn { padding: 10px 18px; margin: 6px 2px; border: none; border-radius: 4px; background: #b71c1c; color: #fff; font-size: 1em; cursor: pointer; font-weight: bold; text-shadow: 1px 1px 2px #b71c1c; }
        .btn:hover { background: #d32f2f; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px #0001; }
        th, td { border: 1px solid #e57373; padding: 8px 4px; text-align: left; font-size: 0.97em; }
        th { background: #ffcdd2; color: #b71c1c; text-shadow: 1px 1px 2px #fff; }
        @media (max-width: 800px) {
            form, table { max-width: 100%; font-size: 0.98em; }
            th, td { font-size: 0.95em; }
        }
        @media (max-width: 600px) {
            form { padding: 8px; }
            table, thead, tbody, th, td, tr { display: block; }
            thead { display: none; }
            tr { margin-bottom: 15px; background: #fff; border-radius: 8px; box-shadow: 0 1px 4px #0001; }
            td { border: none; border-bottom: 1px solid #eee; position: relative; padding-left: 50%; min-height: 36px; }
            td:before {
                position: absolute;
                top: 8px; left: 8px; width: 45%;
                white-space: nowrap;
                font-weight: bold;
                color: #b71c1c;
                content: attr(data-label);
            }
        }
        footer { margin-top:40px; text-align:center; color:#b71c1c; font-size:1em; }
        hr { border: 0; border-top: 2px solid #b71c1c; }
    </style>
</head>
<body>
        <h2>Inventario del Colegio Fe y Alegría 44</h2>
        <div class="subtitulo">Inventario 2025</div>
        <button class="btn" style="float:right;margin-top:10px;" onclick="document.getElementById('modalManual').style.display='block'">¿Cómo usar esta página?</button>
        <div id="modalManual" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);">
            <div style="background:#fff;max-width:500px;margin:60px auto;padding:24px 18px 18px 18px;border-radius:10px;box-shadow:0 4px 24px #0003;position:relative;">
                <button onclick="document.getElementById('modalManual').style.display='none'" style="position:absolute;top:8px;right:12px;font-size:1.3em;background:none;border:none;color:#b71c1c;cursor:pointer;">&times;</button>
                <h3 style="color:#b71c1c;text-align:center;">Manual de Uso - Inventario Local</h3>
                <ul style="font-size:1em;line-height:1.5;margin-bottom:10px;">
                    <li><b>¿Para qué sirve?</b> Permite registrar y exportar el inventario de aulas de forma local, sin internet ni base de datos.</li>
                    <li><b>¿Cómo usar?</b>
                        <ol>
                            <li>Selecciona el nivel educativo y el aula.</li>
                            <li>Llena los datos del inventario.</li>
                            <li>Haz clic en <b>Agregar</b> para guardar el registro.</li>
                            <li>Edita o elimina registros si es necesario.</li>
                            <li>Al finalizar, haz clic en <b>Exportar a CSV</b> para descargar el archivo.</li>
                            <li>Envía el archivo CSV al responsable para su integración central.</li>
                        </ol>
                    </li>
                    
                    <li><b>Recomendaciones:</b>
                        <ul>
                            <li>Haz copia de seguridad del CSV después de cada sesión.</li>
                            <li>Si tienes dudas, consulta al responsable o este manual.</li>
                            <li>Usa navegadores actualizados.</li>
                        </ul>
                    </li>
                </ul>
                <div style="text-align:center;color:#b71c1c;font-size:0.95em;">Manual incluido para orientar a los usuarios.<br>17/11/2025</div>
            </div>
        </div>
    <form id="formulario">
        <label>Nivel:
            <select name="nivel" required>
                <option value="Inicial">Inicial</option>
                <option value="Primaria">Primaria</option>
                <option value="Secundaria">Secundaria</option>
            </select>
        </label>
        <label>Aula Funcional:
            <select name="aula_funcional" id="aula_funcional" required>
                <option value="">Seleccione un aula</option>
            </select>
        </label>
        <label>Denominación: <input name="denominacion" required placeholder="Ej: Mesa de madera, Silla metálica"></label>
        <label>Cantidad: <input name="cantidad" type="number" min="1" value="1" required placeholder="Ej: 10"></label>
        <label>Marca: <input name="marca" placeholder="Ej: Madera Perú, Genérica"></label>
        <label>Modelo: <input name="modelo" placeholder="Ej: Grande Bipersonal, Estándar"></label>
        <label>Tipo:
            <select name="tipo" required>
                <option value="Mobiliario">Mobiliario</option>
                <option value="Equipo">Equipo</option>
                <option value="Material">Material</option>
                <option value="Otro">Otro</option>
            </select>
        </label>
        <label>Color: <input name="color" placeholder="Ej: Marrón, Azul"></label>
        <label>Serie: <input name="serie" placeholder="Ej: 12345, SN-001"></label>
        <label>Largo: <input name="largo" type="number" step="0.01" placeholder="Ej: 1.20"></label>
        <label>Ancho: <input name="ancho" type="number" step="0.01" placeholder="Ej: 0.60"></label>
        <label>Alto: <input name="alto" type="number" step="0.01" placeholder="Ej: 0.75"></label>
        <label>Documento de Alta: <input name="documento_alta" placeholder="Ej: DOC-001"></label>
        <label>Fecha de Compra: <input name="fecha_compra" type="date" placeholder="Ej: 2025-03-15"></label>
        <label>Número de Documento: <input name="numero_documento" placeholder="Ej: 000123"></label>
        <label>Estado:
            <select name="estado" required>
                <option value="Bueno">Bueno</option>
                <option value="Regular">Regular</option>
                <option value="Malo">Malo</option>
            </select>
        </label>
        <label>Procedencia:
            <select name="procedencia" required>
                <option value="UGEL">UGEL</option>
                <option value="Fe y Alegría">Fe y Alegría</option>
                <option value="Jesuitas">Jesuitas</option>
                <option value="Otra">Otra</option>
            </select>
        </label>
        <label>Observaciones: <input name="observaciones" placeholder="Ej: Sin detalles, Reparar pata"></label>
        <label>Usuario Responsable: <input name="usuario_responsable" placeholder="Ej: Juan Pérez"></label>
        <label>Ubicación: <input name="ubicacion" placeholder="Ej: Aula 5to B, Dirección"></label>
        <button type="submit" class="btn">Agregar</button>
        <button type="button" class="btn" onclick="exportarCSV()">Exportar a CSV</button>
        <button type="button" class="btn" onclick="limpiarInventario()">Limpiar Inventario</button>
    </form>
    <h3>Inventario Actual</h3>
    <table id="tabla">
        <thead>
        <tr>
            <th>Nivel</th><th>Aula</th><th>Denominación</th><th>Cantidad</th><th>Marca</th><th>Modelo</th><th>Tipo</th><th>Color</th><th>Serie</th><th>Largo</th><th>Ancho</th><th>Alto</th><th>Doc. Alta</th><th>Fecha Compra</th><th>N° Doc</th><th>Estado</th><th>Procedencia</th><th>Obs.</th><th>Usuario</th><th>Ubicación</th><th>Fecha Registro</th><th>Acciones</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
    <footer>
        <hr style="margin:18px 0;">
        <b>Sistema realizado por Max System</b><br>
        <span>Inventario del Colegio Fe y Alegría 44 &mdash; 2025</span><br>
        &copy; <span id="anio"></span> Derechos reservados
    </footer>
    <script>
    const inventario = [];
    const tabla = document.querySelector('#tabla tbody');
    document.getElementById('anio').textContent = new Date().getFullYear();

    // Lista de aulas embebida directamente en el HTML
    const aulasData = {
  "Inicial": [
    "Aula 1",
    "Aula 2",
    "Aula 3",
    "Aula 4",
    "Aula 5",
    "Aula 6",
    "Aula 7",
    "Aula 8",
    "Aula 9",
    "Aula 10",
    "Dirección",
    "Secretaría",
    "Sala de Psicomotricidad",
    "Almacen"
  ],
  "Primaria": [
    "1A",
    "1B",
    "2A",
    "2B",
    "3A",
    "3B",
    "4A",
    "4B",
    "5A",
    "5B",
    "6A",
    "6B",
    "Dirección",
    "Secretaría",
    "Sala de Cómputo",
    "Biblioteca"
  ],
  "Secundaria": [
    "Aula 1",
    "Aula 2",
    "Aula 3",
    "1A",
    "1B",
    "2A",
    "2B",
    "3A",
    "3B",
    "4A",
    "4B",
    "5A",
    "5B",
    "ATF",
    "Aula 8",
    "Secretaría",
    "Dirección",
    "Sala Subdirección",
    "Coordinación",
    "Sub Dirección",
    "Pastoral",
    "TOPICO",
    "PSICOLOGIA",
    "Sala de Docentes",
    "Auditorio",
    "Biblioteca",
    "Aula 18",
    "Aula 19"
  ]
};

    function actualizarAulas() {
        const nivel = document.querySelector('select[name="nivel"]').value;
        const selectAula = document.getElementById('aula_funcional');
        selectAula.innerHTML = '<option value="">Seleccione un aula</option>';
        if (aulasData[nivel]) {
            aulasData[nivel].forEach(aula => {
                const opt = document.createElement('option');
                opt.value = aula;
                opt.textContent = aula;
                selectAula.appendChild(opt);
            });
        }
    }

    document.querySelector('select[name="nivel"]').addEventListener('change', actualizarAulas);
    actualizarAulas();

    function renderTabla() {
        tabla.innerHTML = '';
        inventario.forEach((item, idx) => {
            const tr = document.createElement('tr');
            const columnas = [
                'nivel','aula_funcional','denominacion','cantidad','marca','modelo','tipo','color','serie','largo','ancho','alto','documento_alta','fecha_compra','numero_documento','estado','procedencia','observaciones','usuario_responsable','ubicacion','fecha_registro'
            ];
            columnas.forEach((col, i) => {
                const td = document.createElement('td');
                td.setAttribute('data-label', tabla.parentElement.rows[0].cells[i].textContent);
                td.textContent = item[col] || '';
                tr.appendChild(td);
            });
            // Botones de acción
            const tdAcciones = document.createElement('td');
            tdAcciones.setAttribute('data-label', 'Acciones');
            tdAcciones.style.textAlign = 'center';
            tdAcciones.innerHTML = `
                <button class="btn" style="background:#1976d2;margin:2px 2px 2px 0;padding:4px 10px;font-size:0.95em;" onclick="editarRegistro(${idx})">Editar</button>
                <button class="btn" style="background:#c62828;margin:2px 0 2px 2px;padding:4px 10px;font-size:0.95em;" onclick="eliminarRegistro(${idx})">Eliminar</button>
            `;
            tr.appendChild(tdAcciones);
            tabla.appendChild(tr);
        });
    }

    // Variable global para saber si estamos editando
    let editandoIdx = null;

    // Función para eliminar un registro (debe ser global)
    function eliminarRegistro(idx) {
        if (confirm('¿Seguro que deseas eliminar este registro?')) {
            inventario.splice(idx, 1);
            renderTabla();
        }
    }

    // Función para editar un registro (debe ser global)
    function editarRegistro(idx) {
        const item = inventario[idx];
        const form = document.getElementById('formulario');
        // Selecciona el nivel antes de cargar el aula
        if (form.elements['nivel']) {
            form.elements['nivel'].value = item['nivel'];
            actualizarAulas();
        }
        // Llenar el formulario con los datos del registro
        for (const key in item) {
            if (form.elements[key]) {
                form.elements[key].value = item[key];
            }
        }
        editandoIdx = idx;
        // Llevar el foco al primer campo
        form.elements['denominacion'].focus();
    }

    document.getElementById('formulario').onsubmit = function(e) {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(this));
        data.cantidad = parseInt(data.cantidad) || 1;
        data.fecha_registro = new Date().toISOString().slice(0,10);
        if (editandoIdx !== null) {
            // Si estamos editando, reemplazamos el registro
            inventario[editandoIdx] = data;
            editandoIdx = null;
        } else {
            // Validación de duplicados (nivel, aula_funcional, denominacion, serie)
            const idx = inventario.findIndex(row => row.nivel === data.nivel && row.aula_funcional === data.aula_funcional && row.denominacion === data.denominacion && row.serie === data.serie);
            if (idx !== -1) {
                // Si ya existe, suma la cantidad
                inventario[idx].cantidad = parseInt(inventario[idx].cantidad) + data.cantidad;
            } else {
                inventario.push(data);
            }
        }
        renderTabla();
        this.reset();
        actualizarAulas(); // Para que el select no se reinicie
    };

    function exportarCSV() {
        if (inventario.length === 0) {
            alert('No hay datos para exportar.');
            return;
        }
        // Orden de columnas actualizado
        const columnas = [
            'nivel','aula_funcional','denominacion','cantidad','marca','modelo','tipo','color','serie','largo','ancho','alto','documento_alta','fecha_compra','numero_documento','estado','procedencia','observaciones','usuario_responsable','ubicacion','fecha_registro'
        ];
        const encabezados = columnas;
        const filas = inventario.map(obj => columnas.map(k => '"'+(obj[k]||'')+'"').join(','));
        const csv = [encabezados.join(','), ...filas].join('\r\n');
        const blob = new Blob([csv], {type: 'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'inventario_aula.csv';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function limpiarInventario() {
        if (confirm('¿Seguro que deseas limpiar el inventario?')) {
            inventario.length = 0;
            renderTabla();
        }
    }
    </script>
</body>
</html>
