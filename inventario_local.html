<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="inventario_favicon.svg">
    <title>Inventario del Colegio Fe y Alegría 44 - 2025</title>
    <style>
        :root {
            --primary: #b71c1c;
            --primary-light: #d32f2f;
            --primary-lighter: #ffcdd2;
            --primary-lightest: #ffeaea;
            --text-on-primary: #fff;
            --text-dark: #222;
            --border-color: #e57373;
            --shadow-sm: 0 1px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 24px rgba(0,0,0,0.12);
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            background: #f9f9fb url('fachada_fya44.jpg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            padding-bottom: 60px;
        }
        /* Cabecera sticky */
        .cabecera {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            box-shadow: var(--shadow-lg);
            padding: 20px 16px 10px 16px;
            border-radius: 0 0 18px 18px;
        }
        h2 {
            color: var(--text-on-primary);
            text-align: center;
            margin: 0 0 4px 0;
            text-shadow: 2px 2px 10px var(--primary), 0 1px 0 #fff;
            letter-spacing: 1px;
            font-size: 1.8em;
        }
        .subtitulo {
            text-align: center;
            color: var(--text-on-primary);
            font-size: 1.1em;
            margin: 0;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        .btn-manual {
            position: absolute;
            top: 12px;
            right: 16px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.25);
            border: 1px solid rgba(255,255,255,0.5);
            color: var(--text-on-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-manual:hover {
            background: rgba(255,255,255,0.4);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        h3 {
            color: var(--primary);
            text-align: center;
            margin: 20px 0 12px 0;
            text-shadow: 2px 2px 6px var(--primary-lighter), 0 1px 0 #fff;
        }
        /* Contenedor del formulario */
        .form-container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 0 16px;
        }
        form {
            background: rgba(255,255,255,0.98);
            padding: 24px;
            border-radius: 14px;
            box-shadow: var(--shadow-lg);
        }
        /* Grid para formularios responsive */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        form label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.95em;
            color: var(--primary);
            font-weight: 600;
        }
        form input, form select {
            width: 100%;
            padding: 10px 12px;
            border: 1.5px solid var(--primary);
            border-radius: 6px;
            font-size: 1em;
            color: var(--text-dark);
            background: #fff;
            box-shadow: var(--shadow-sm);
            transition: border 0.2s, box-shadow 0.2s;
        }
        form input:focus, form select:focus {
            border: 1.5px solid var(--primary-light);
            box-shadow: 0 0 0 3px rgba(183,28,28,0.1);
            outline: none;
        }
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 20px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--text-on-primary);
            font-size: 1em;
            cursor: pointer;
            font-weight: bold;
            box-shadow: var(--shadow-md);
            letter-spacing: 0.5px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .btn:hover {
            background: var(--primary-light);
            box-shadow: 0 4px 16px rgba(183,28,28,0.25);
            transform: translateY(-1px);
        }
        .btn:active {
            transform: translateY(0);
        }
        /* Contenedor de tabla con scroll horizontal */
        .table-container {
            max-width: 1200px;
            margin: 0 auto 40px auto;
            padding: 0 16px;
            overflow-x: auto;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            min-width: 800px;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }
        th, td {
            border: 1px solid var(--border-color);
            padding: 12px 8px;
            text-align: left;
            font-size: 0.95em;
            background: #fff;
            transition: background 0.2s;
        }
        th {
            background: var(--primary-lighter);
            color: var(--primary);
            text-shadow: 1px 1px 2px #fff;
            font-size: 0.98em;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tbody tr:hover td {
            background: var(--primary-lightest);
        }
        footer {
            margin-top: 60px;
            text-align: center;
            color: var(--primary);
            font-size: 1em;
            background: rgba(255,255,255,0.98);
            border-radius: 18px 18px 0 0;
            box-shadow: 0 -2px 12px rgba(0,0,0,0.12);
            padding: 18px 16px 10px 16px;
        }
        hr { border: 0; border-top: 2px solid var(--primary); margin: 12px 0; }
        
        /* Responsive breakpoints */
        @media (max-width: 900px) {
            h2 { font-size: 1.5em; }
            .btn-manual { position: static; display: block; margin: 12px auto 0 auto; }
            .form-grid { grid-template-columns: 1fr; }
            .btn-group { flex-direction: column; }
            .btn { width: 100%; }
        }
        @media (max-width: 600px) {
            .cabecera { padding: 16px 12px 8px 12px; }
            h2 { font-size: 1.3em; }
            .subtitulo { font-size: 1em; }
            form { padding: 16px; }
            .table-container { padding: 0 8px; }
            th, td { font-size: 0.9em; padding: 8px 6px; }
        }
    </style>
</head>
<body>
    <div class="cabecera">
        <h2>Inventario del Colegio Fe y Alegría 44</h2>
        <div class="subtitulo">Inventario 2025</div>
        <button class="btn-manual" onclick="document.getElementById('modalManual').style.display='block'">¿Cómo usar esta página?</button>
    </div>
        <div id="modalManual" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);">
            <div style="background:#fff;max-width:500px;margin:60px auto;padding:24px 18px 18px 18px;border-radius:10px;box-shadow:0 4px 24px #0003;position:relative;">
                <button onclick="document.getElementById('modalManual').style.display='none'" style="position:absolute;top:8px;right:12px;font-size:1.3em;background:none;border:none;color:#b71c1c;cursor:pointer;">&times;</button>
                <h3 style="color:#b71c1c;text-align:center;">Manual de Uso - Inventario Local</h3>
                <ul style="font-size:1em;line-height:1.5;margin-bottom:10px;">
                    <li><b>¿Para qué sirve?</b> Permite registrar y exportar el inventario de aulas de forma local, sin internet ni base de datos.</li>
                    <li><b>¿Cómo usar?</b>
                        <ol>
                            <li>Selecciona el nivel educativo y el aula.</li>
                            <li>Llena los datos del inventario.</li>
                            <li>Haz clic en <b>Agregar</b> para guardar el registro.</li>
                            <li>Edita o elimina registros si es necesario.</li>
                            <li>Al finalizar, haz clic en <b>Exportar a CSV</b> para descargar el archivo.</li>
                            <li>Envía el archivo CSV al responsable para su integración central.</li>
                        </ol>
                    </li>
                    
                    <li><b>Recomendaciones:</b>
                        <ul>
                            <li>Haz copia de seguridad del CSV después de cada sesión.</li>
                            <li>Si tienes dudas, consulta al responsable o este manual.</li>
                            <li>Usa navegadores actualizados.</li>
                        </ul>
                    </li>
                </ul>
                <div style="text-align:center;color:#b71c1c;font-size:0.95em;">Manual incluido para orientar a los usuarios.<br>17/11/2025</div>
            </div>
        </div>
    <div class="form-container">
        <form id="formulario">
            <div class="form-grid">
                <div class="form-group">
                    <label>Nivel:</label>
                    <select name="nivel" required>
                        <option value="Inicial">Inicial</option>
                        <option value="Primaria">Primaria</option>
                        <option value="Secundaria">Secundaria</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Aula Funcional:</label>
                    <select name="aula_funcional" id="aula_funcional" required>
                        <option value="">Seleccione un aula</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Denominación:</label>
                    <input name="denominacion" required placeholder="Ej: Mesa de madera, Silla metálica">
                </div>
                <div class="form-group">
                    <label>Cantidad:</label>
                    <input name="cantidad" type="number" min="1" value="1" required placeholder="Ej: 10">
                </div>
                <div class="form-group">
                    <label>Marca:</label>
                    <input name="marca" placeholder="Ej: Madera Perú, Genérica">
                </div>
                <div class="form-group">
                    <label>Modelo:</label>
                    <input name="modelo" placeholder="Ej: Grande Bipersonal, Estándar">
                </div>
                <div class="form-group">
                    <label>Tipo:</label>
                    <select name="tipo" required>
                        <option value="Mobiliario">Mobiliario</option>
                        <option value="Equipo">Equipo</option>
                        <option value="Material">Material</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Color:</label>
                    <input name="color" placeholder="Ej: Marrón, Azul">
                </div>
                <div class="form-group">
                    <label>Serie:</label>
                    <input name="serie" placeholder="Ej: 12345, SN-001">
                </div>
                <div class="form-group">
                    <label>Largo:</label>
                    <input name="largo" type="number" step="0.01" placeholder="Ej: 1.20">
                </div>
                <div class="form-group">
                    <label>Ancho:</label>
                    <input name="ancho" type="number" step="0.01" placeholder="Ej: 0.60">
                </div>
                <div class="form-group">
                    <label>Alto:</label>
                    <input name="alto" type="number" step="0.01" placeholder="Ej: 0.75">
                </div>
                <div class="form-group">
                    <label>Documento de Alta:</label>
                    <input name="documento_alta" placeholder="Ej: DOC-001">
                </div>
                <div class="form-group">
                    <label>Fecha de Compra:</label>
                    <input name="fecha_compra" type="date" placeholder="Ej: 2025-03-15">
                </div>
                <div class="form-group">
                    <label>Número de Documento:</label>
                    <input name="numero_documento" placeholder="Ej: 000123">
                </div>
                <div class="form-group">
                    <label>Estado:</label>
                    <select name="estado" required>
                        <option value="Bueno">Bueno</option>
                        <option value="Regular">Regular</option>
                        <option value="Malo">Malo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Procedencia:</label>
                    <select name="procedencia" required>
                        <option value="UGEL">UGEL</option>
                        <option value="Fe y Alegría">Fe y Alegría</option>
                        <option value="Jesuitas">Jesuitas</option>
                        <option value="Otra">Otra</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Observaciones:</label>
                    <input name="observaciones" placeholder="Ej: Sin detalles, Reparar pata">
                </div>
                <div class="form-group">
                    <label>Usuario Responsable:</label>
                    <input name="usuario_responsable" placeholder="Ej: Juan Pérez">
                </div>
                <div class="form-group">
                    <label>Ubicación:</label>
                    <input name="ubicacion" placeholder="Ej: Aula 5to B, Dirección">
                </div>
            </div>
            <div class="btn-group">
                <button type="submit" class="btn">Agregar</button>
                <button type="button" class="btn" onclick="exportarCSV()">Exportar a CSV</button>
                <button type="button" class="btn" onclick="limpiarInventario()">Limpiar Inventario</button>
            </div>
        </form>
    </div>
    <h3>Inventario Actual</h3>
    <div class="table-container">
        <table id="tabla">
        <thead>
        <tr>
            <th>Nivel</th><th>Aula</th><th>Denominación</th><th>Cantidad</th><th>Marca</th><th>Modelo</th><th>Tipo</th><th>Color</th><th>Serie</th><th>Largo</th><th>Ancho</th><th>Alto</th><th>Doc. Alta</th><th>Fecha Compra</th><th>N° Doc</th><th>Estado</th><th>Procedencia</th><th>Obs.</th><th>Usuario</th><th>Ubicación</th><th>Fecha Registro</th><th>Acciones</th>
        </tr>
        </thead>
        <tbody></tbody>
        </table>
    </div>
    <footer>
        <hr style="margin:18px 0;">
        <b>Sistema realizado por Max System</b><br>
        <span>Inventario del Colegio Fe y Alegría 44 &mdash; 2025</span><br>
        &copy; <span id="anio"></span> Derechos reservados
    </footer>
    <script>
    // Cargar inventario desde localStorage si existe
    let inventario = [];
    if (localStorage.getItem('inventario_local')) {
        try {
            inventario = JSON.parse(localStorage.getItem('inventario_local')) || [];
        } catch(e) { inventario = []; }
    }
    const tabla = document.querySelector('#tabla tbody');
    document.getElementById('anio').textContent = new Date().getFullYear();

    // Lista de aulas embebida directamente en el HTML
    const aulasData = {
  "Inicial": [
    "3 Años A",
    "3 Años B",
    "3 Años C",
    "4 Años A",
    "4 Años B",
    "4 Años C",
    "5 Años A",
    "5 Años B",
    "5 Años C",
    "Sala de Fotocopias",
    "PSICOLOGIA",
    "Almacen"
  ],
  "Primaria": [
    "1A",
    "1B",
    "1C",
    "2A",
    "2B",
    "2C",
    "3A",
    "3B",
    "4A",
    "4B",
    "4C",
    "5A",
    "5B",
    "6A",
    "6B",
    "Dirección",
    "Secretaría",
    "Sala de Cómputo",
    "Biblioteca",
    "Almacen",
    "Sala de Docentes",
    "Psicología",
    "Cocina",
    "Educación Fisíca"
  ],
  "Secundaria": [
    "Aula 1",
    "Aula 2",
    "Aula 3",
    "1A",
    "1B",
    "2A",
    "2B",
    "3A",
    "3B",
    "4A",
    "4B",
    "5A",
    "5B",
    "ATF",
    "Aula 8",
    "Secretaría",
    "Dirección",
    "Sala Subdirección",
    "Coordinación",
    "Sub Dirección",
    "Pastoral",
    "TOPICO",
    "PSICOLOGIA",
    "Sala de Docentes",
    "Auditorio",
    "Biblioteca",
    "Aula 18",
    "Aula 19",
    "Capilla",
    "Cocina",
    "Departamento de Educación Fisíca",
    "Taller de Musica",
    "Taller de Reposteria",
    "Laboratorio de Ciencias",
    "Atencion a Padres de Familia Aula 14",
    "Comedor"
  ]
};

    function actualizarAulas() {
        const nivel = document.querySelector('select[name="nivel"]').value;
        const selectAula = document.getElementById('aula_funcional');
        selectAula.innerHTML = '<option value="">Seleccione un aula</option>';
        if (aulasData[nivel]) {
            aulasData[nivel].forEach(aula => {
                const opt = document.createElement('option');
                opt.value = aula;
                opt.textContent = aula;
                selectAula.appendChild(opt);
            });
        }
    }

    document.querySelector('select[name="nivel"]').addEventListener('change', actualizarAulas);
    actualizarAulas();

    function renderTabla() {
        tabla.innerHTML = '';
        inventario.forEach((item, idx) => {
            const tr = document.createElement('tr');
            const columnas = [
                'nivel','aula_funcional','denominacion','cantidad','marca','modelo','tipo','color','serie','largo','ancho','alto','documento_alta','fecha_compra','numero_documento','estado','procedencia','observaciones','usuario_responsable','ubicacion','fecha_registro'
            ];
            columnas.forEach((col, i) => {
                const td = document.createElement('td');
                td.setAttribute('data-label', tabla.parentElement.rows[0].cells[i].textContent);
                td.textContent = item[col] || '';
                tr.appendChild(td);
            });
            // Botones de acción
            const tdAcciones = document.createElement('td');
            tdAcciones.setAttribute('data-label', 'Acciones');
            tdAcciones.style.textAlign = 'center';
            tdAcciones.innerHTML = `
                <button class="btn" style="background:#1976d2;margin:2px 2px 2px 0;padding:4px 10px;font-size:0.95em;" onclick="editarRegistro(${idx})">Editar</button>
                <button class="btn" style="background:#c62828;margin:2px 0 2px 2px;padding:4px 10px;font-size:0.95em;" onclick="eliminarRegistro(${idx})">Eliminar</button>
            `;
            tr.appendChild(tdAcciones);
            tabla.appendChild(tr);
        });
        localStorage.setItem('inventario_local', JSON.stringify(inventario));
    }

    // Variable global para saber si estamos editando
    let editandoIdx = null;

    // Función para eliminar un registro (debe ser global)
    function eliminarRegistro(idx) {
        if (confirm('¿Seguro que deseas eliminar este registro?')) {
            inventario.splice(idx, 1);
            renderTabla();
        }
    }

    // Función para editar un registro (debe ser global)
    function editarRegistro(idx) {
        const item = inventario[idx];
        const form = document.getElementById('formulario');
        // Selecciona el nivel antes de cargar el aula
        if (form.elements['nivel']) {
            form.elements['nivel'].value = item['nivel'];
            actualizarAulas();
        }
        // Llenar el formulario con los datos del registro
        for (const key in item) {
            if (form.elements[key]) {
                form.elements[key].value = item[key];
            }
        }
        editandoIdx = idx;
        // Llevar el foco al primer campo
        form.elements['denominacion'].focus();
    }

    document.getElementById('formulario').onsubmit = function(e) {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(this));
        data.cantidad = parseInt(data.cantidad) || 1;
        data.fecha_registro = new Date().toISOString().slice(0,10);
        if (editandoIdx !== null) {
            // Si estamos editando, reemplazamos el registro
            inventario[editandoIdx] = data;
            editandoIdx = null;
        } else {
            // Validación de duplicados (nivel, aula_funcional, denominacion, serie)
            const idx = inventario.findIndex(row => row.nivel === data.nivel && row.aula_funcional === data.aula_funcional && row.denominacion === data.denominacion && row.serie === data.serie);
            if (idx !== -1) {
                // Si ya existe, suma la cantidad
                inventario[idx].cantidad = parseInt(inventario[idx].cantidad) + data.cantidad;
            } else {
                inventario.push(data);
            }
        }
        renderTabla();
        this.reset();
        actualizarAulas(); // Para que el select no se reinicie
    };

    function exportarCSV() {
        if (inventario.length === 0) {
            alert('No hay datos para exportar.');
            return;
        }
        // Orden de columnas actualizado
        const columnas = [
            'nivel','aula_funcional','denominacion','cantidad','marca','modelo','tipo','color','serie','largo','ancho','alto','documento_alta','fecha_compra','numero_documento','estado','procedencia','observaciones','usuario_responsable','ubicacion','fecha_registro'
        ];
        const encabezados = columnas;
        const filas = inventario.map(obj => columnas.map(k => '"'+(obj[k]||'')+'"').join(','));
        const csv = [encabezados.join(','), ...filas].join('\r\n');
        const blob = new Blob([csv], {type: 'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        
        // Generar nombre dinámico basado en el PRIMER REGISTRO del inventario
        let nivel = 'SinNivel';
        let aula = 'SinAula';
        
        if (inventario.length > 0) {
            nivel = inventario[0].nivel || 'SinNivel';
            aula = inventario[0].aula_funcional || 'SinAula';
        }
        
        // Limpiar caracteres especiales del nombre del aula para el archivo
        const aulaLimpia = aula.replace(/[^a-zA-Z0-9]/g, '');
        const nombreArchivo = `inventario_${nivel}_${aulaLimpia}.csv`;
        
        a.download = nombreArchivo;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function limpiarInventario() {
        if (confirm('¿Seguro que deseas limpiar el inventario?')) {
            inventario.length = 0;
            localStorage.removeItem('inventario_local');
            renderTabla();
        }
    }
    </script>
</body>
</html>
